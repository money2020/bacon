(function(){angular.module("money2020.bacon.transactions",[]).controller("TransactionsController",function($scope,$timeout,TransactionAPI,State){var addFraud,addGood;return console.log("Transaction Controller Initialized"),$scope.State=State,State.add({id:"sketchysms01",score:.5,state:{id:"sms",label:"Sketchy SMS"}}),addGood=function(){return State.add({id:"good"+Math.random(),score:.5,state:{id:"ok",label:"Good"}},$timeout(addGood,1e3*Math.random()))},addFraud=function(){return State.add({id:"fraud"+Math.random(),score:.5,state:{id:"fraud",label:"Fraud"}},$timeout(addFraud,5e3*Math.random()))},$timeout(addGood,0),$timeout(addFraud,0)}).constant("TransactionStates",{ok:"ok",fraud:"fraud"}).service("TransactionAPI",function($q){return{getState:function(){return new $q(function(resolve){return resolve(null)})},getSketchyTransactions:function(){}}}).factory("AppState",function($timeout,TransactionStates){return function(state){var initState,update;return initState=function(){var result;return result={},result.sketchy={},result.ok={label:"ok",stats:{},transactions:{}},result.fraud={label:"fraud",stats:{},transactions:{}},result},update=function(newState){return newState=JSON.parse(JSON.stringify(newState)),null==state&&(state={}),state.sketchy=newState.sketchy,state.ok={label:"ok",stats:{},transactions:{}},state.fraud={label:"fraud",stats:{},transactions:{}}},state||update(initState()),{getState:function(){return state},updateSketchy:function(){return update(newState)},add:function(transaction){var isTransient,label,_base,_base1,_base2,_name,_name1,_ref,_this=this;return isTransient=(_ref=transaction.state.id)===TransactionStates.ok||_ref===TransactionStates.fraud,isTransient?(null==state[_name=transaction.state.id]&&(state[_name]={stats:{},transactions:{}}),null==(_base=state[transaction.state.id].stats).count&&(_base.count=0),state[transaction.state.id].stats.count++,state[transaction.state.id].transactions[transaction.id]=transaction,$timeout(function(){return _this.del(transaction)},1800)):(label=transaction.state.label,null==(_base1=state.sketchy)[_name1=transaction.state.id]&&(_base1[_name1]={label:label,stats:{},transactions:{}}),null==(_base2=state.sketchy[transaction.state.id].stats).count&&(_base2.count=0),state.sketchy[transaction.state.id].stats.count++,state.sketchy[transaction.state.id].transactions[transaction.id]=transaction)},del:function(transaction){var collection,isTransient,_ref;return isTransient=(_ref=transaction.state.id)===TransactionStates.ok||_ref===TransactionStates.fraud,collection=function(){return isTransient?state[transaction.state.id]:state.sketchy[transaction.state.id]}(),delete collection.transactions[transaction.id]}}}}).directive("transactions",function(){return{restrict:"E",replace:!0,templateUrl:"/widgets/widget-transactions.html",link:function(scope){return scope.state=scope.State.getState()}}}).directive("transactionList",function(){return{restrict:"E",replace:!0,templateUrl:"/widgets/widget-transaction-list.html",scope:{state:"=",animate:"="}}}).directive("transactionListItem",function($timeout){return{restrict:"C",link:function(scope,element){var $el;return console.log("sup"),$el=$(element),$timeout(function(){var velocity;if($el.hasClass("fallanimation"))return velocity=4*Math.random()+6,$timeout(function(){return $el.box2d({"y-velocity":velocity})},0)},0)}}})}).call(this);